**Important: Chat Overflow is still work in progress. So this guide will probably change in the future!**

There are 3 important steps when you want to create and implement a new chat overflow plugin:

1. Create a new plugin project with the commands of the framework
2. Inspect the `plugin.xml` file
3. Extend the plugin with own logic

## Create a new plugin project

Use the *Create Plugin* configuration or start the custom task `sbt create` directly. Enter the basic plugin information in the command prompt. This includes mandatory values like the name, author, version and base plugin folder (e.g. `plugins-public`) and some optional values like a description, a website, a link to a source repo, a link to a bug tracker and a license.

The command creates the folder structure of the new plugin and adds a basic build file. Here you can also add custom dependencies. In addition the command generates a basic `plugin.xml` containing all the passed information like name and description and a basic source code file generated in the language of your choice to get you started. Note that currently only Scala and Java are supported.

Next, run the custom task `sbt fetch` to let the framework look for new plugins and update the plugin reference file `plugins.sbt`. If you're using IntelliJ, you can now reload the framework by hand to register the plugin as new and custom project. You should also run `sbt reload` (Yes, both actions have different effects although they shouldn't).

## Inspect the `plugin.xml` file

All the metadata of the plugin like the name and the author of the plugin is saved in a xml file which is located at `src/main/resources/plugin.xml` in the plugin directory. This file gets autogenerated by the create command but in case you need to update a value its good to know where this file is located.

A simple version of the `plugin.xml` file might look like this:

 ```xml
<plugin>
    <name>Demonstration</name>
    <author>sebinside</author>
    <description>This is a simple plugin for demonstration purposes.</description>
    <api>
        <major>3</major>
        <minor>0</minor>
    </api>
    <version>0.3.0</version>
    <website>https://codeoverflow.org</website>
    <sourceRepo>https://github.com/codeoverflow-org/chatoverflow-plugins</sourceRepo>
    <bugtracker>https://github.com/codeoverflow-org/chatoverflow/issues</bugtracker>
    <license>EPL-2.0</license>
</plugin>
 ```

The properties called name, author, api versions and version are mandatory and the framework won't load the plugin if one of these is missing. All others are optional informations for the user. If you don't want to specify a value for those you can just omit them.

The api tag contains the API-Version, you developed the plugin with. These are evaluated in the loading process to ensure that your plugin works with the framework version from the user. You can get these numbers either from `org.codeoverflow.chatoverflow.api.APIVersion` in the api project or in the `build.sbt` also in the api project.

## Extend the Plugin with own logic

The last step is the creation of the plugin class, which contains your own plugin logic. Again the create command has autogenerated a basic class extending `org.codeoverflow.chatoverflow.api.plugin.PluginImpl` in the language of your choice. Such a file might look like this in case of Scala:

```scala
import org.codeoverflow.chatoverflow.api.plugin.{PluginImpl, PluginManager}

class DemonstrationPlugin(manager: PluginManager) extends PluginImpl(manager) {

  // require more requirements as needed here
  private val sampleReq = require.input.sample("sampleReq", "Sample requirement", true)

  // you can adjust the loop interval here
  // loopInterval = 1000;

  /**
    * The setup method is executed one, when the plugin is started. Do NOT define your requirements in here!
    */
  override def setup(): Unit = {
    log("Initialized Demonstration!")
  }
    
  /**
    * The loop method is executed in loop with a specified interval until the shutdown method is called.
    * The loop method is NOT executed if a negative loop interval is set.
    */
  override def loop(): Unit = {
    log("Demonstration loop!")
  }

  /**
    * The shutdown method should contain logic to close everything.
    */
  override def shutdown(): Unit = {
    log("Shutting down Demonstration!")
  }
}
```

The framework searches for a class implementing `org.codeoverflow.chatoverflow.api.plugin.Plugin` when it tries to load a plugin. `PluginImpl` does this for you and also decreases some other boilerplate. Note that the whole plugin is only allowed to have *exactly* one class implementing `Plugin` otherwise the framework won't load your plugin.

All methods in the generated class are pretty self explaining. The only thing we might need to talk about are *requirements*: These are the way to retrieve data from the outside world and returning information to it. Basically, you can require everything from a single parameter, set by the user, to full access to a users livestream chat.

Thanks to `PluginImpl` a requirements object is already created, meaning you can start adding requirements right away. Here is a example:

```scala
private val twitchChatInput = require.input.twitchChat("reqTwitch", "A twitch channel", false)
private val nameToSayHelloTo = require.parameter.string("reqHello", "Your name", false)
```

This code requires reading-access to a twitch livestream chat and a parameter ("*a name to say hello to"*). Note: You can obviously not specify, which channel the user might choose - but you can be sure, that you will get a working input. This is ensured by the framework.

After this, the last step is the `start` method. And it is as easy as you might think: Just add your own logic now, using the required parameters of your Requirement object. Here is a short example: This code will simply print out all messages from a twitch chat in the console. To access the chat, your required variable is used with the `getValue` method.

```scala
twitchChatInput.getValue.registerMessageHandler(msg => println(msg))
```

Of course, you can also add own classes and infrastructure by now - the important steps are done, happy coding!

*One last note: If your testing your plugin the first time, a full reload might be needed. Use the custom task `[Advanced] Full Reload and run ChatOverlfow` to do so. Afters this, you can configure the framework to start your plugin using the [CLI](usage/Using-the-CLI.md)!*